<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boda de Nagore & Jose - ConfirmaciÃ³n</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Montserrat', sans-serif; }
        .titulo-boda { font-family: 'Dancing Script', cursive; }
        .bg-boda { background-color: #fdfaf7; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 1.2s ease-out forwards; }
        .hidden { display: none !important; } /* AÃ±adimos !important para asegurar que oculte */
    </style>
</head>

<body class="bg-boda text-gray-800 antialiased">

<div class="max-w-2xl mx-auto py-12 px-6 animate-fade-in">

    <header class="text-center mb-12">
        <h1 class="titulo-boda text-7xl text-amber-700 mb-2">Nagore & Jose</h1>
        <p class="text-xs tracking-[0.4em] uppercase text-gray-400 mb-8 italic italic">6 de Junio de 2026</p>

        <div id="countdown" class="flex justify-center gap-4 text-center">
            <div class="bg-white/60 backdrop-blur-md p-4 rounded-2xl shadow-sm border border-white min-w-[85px]">
                <span id="days" class="block text-3xl font-bold text-amber-800">00</span>
                <span class="text-[10px] uppercase text-amber-600 font-semibold tracking-wider">DÃ­as</span>
            </div>
            <div class="bg-white/60 backdrop-blur-md p-4 rounded-2xl shadow-sm border border-white min-w-[85px]">
                <span id="hours" class="block text-3xl font-bold text-amber-800">00</span>
                <span class="text-[10px] uppercase text-amber-600 font-semibold tracking-wider">Horas</span>
            </div>
            <div class="bg-white/60 backdrop-blur-md p-4 rounded-2xl shadow-sm border border-white min-w-[85px]">
                <span id="minutes" class="block text-3xl font-bold text-amber-800">00</span>
                <span class="text-[10px] uppercase text-amber-600 font-semibold tracking-wider">Mins</span>
            </div>
        </div>
    </header>

    <div id="form-container">
        <form action="https://script.google.com/macros/s/AKfycbwdUVdpI2F1i0e6nsBYKST6Z6GoPRL6KF_Q9ZsR3MY-oFo3GX-8sOuLvw-hbIG9sIsp/exec"
              method="POST" id="wedding-form"
              class="bg-white p-8 md:p-12 rounded-[2rem] shadow-xl shadow-amber-900/5 border border-amber-50">

            <div class="mb-10">
                <label class="block text-lg font-semibold mb-4 text-gray-700 italic">ğŸ‘¤ Â¿QuiÃ©nes sois?</label>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" name="nombre" required
                           class="md:col-span-2 w-full p-4 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-amber-200 outline-none transition"
                           placeholder="Nombre y Apellidos">

                    <select name="invitados" id="select-invitados" required
                            class="w-full p-4 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-amber-200 outline-none transition">
                        <option value="1">Vengo solo</option>
                        <option value="2">Somos 2</option>
                        <option value="familia">Familia/Grupo</option>
                    </select>
                </div>

                <div id="aviso-invitados" class="hidden mt-4 p-4 bg-amber-50 border border-amber-200 rounded-xl animate-fade-in text-sm text-amber-900 italic">
                    ğŸ“ <b>Tip de Nagore y Jose:</b> Si tenÃ©is dietas diferentes o querÃ©is pedir canciones distintas, os recomendamos rellenar <u>un formulario por cada persona</u>. Â¡AsÃ­ no se nos escaparÃ¡ nada!
                </div>
            </div>

            <div class="mb-10">
                <label class="block text-lg font-semibold mb-2 text-gray-700 italic">ğŸ• Â¿Preboda?</label>
                <p class="text-xs text-gray-400 mb-4 font-light">5 de junio - 20:30h</p>
                <div class="flex gap-4">
                    <label class="flex-1 border-2 border-gray-50 p-4 rounded-2xl cursor-pointer hover:border-amber-200 hover:bg-amber-50/30 transition flex items-center justify-center gap-2 text-sm">
                        <input type="radio" name="preboda" value="si" class="accent-amber-600" required> Â¡SÃ­!
                    </label>
                    <label class="flex-1 border-2 border-gray-50 p-4 rounded-2xl cursor-pointer hover:border-amber-200 hover:bg-gray-50 transition flex items-center justify-center gap-2 text-sm">
                        <input type="radio" name="preboda" value="no" class="accent-amber-600"> No puedo
                    </label>
                </div>
            </div>

            <div class="mb-10">
                <label class="block text-lg font-semibold mb-4 text-gray-700 italic">ğŸšŒ AutobÃºs</label>
                <select name="autobus" required
                        class="w-full p-4 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-amber-200 outline-none transition">
                    <option value="" disabled selected>Â¿Reservamos sitio para el dÃ­a 6?</option>
                    <option value="si">SÃ­, Â¡guardadme sitio!</option>
                    <option value="no">No, irÃ© por mi cuenta</option>
                </select>
            </div>

            <div class="mb-10">
                <label class="block text-lg font-semibold mb-4 text-gray-700 italic">ğŸ¥¦ Restricciones alimentarias</label>

                <div class="grid grid-cols-2 gap-3 mb-4">
                    <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-amber-50 transition border border-transparent hover:border-amber-100">
                        <input type="checkbox" name="dieta" value="Vegano" class="mr-3 accent-amber-600">
                        <span class="text-sm">Vegano/a</span>
                    </label>
                    <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-amber-50 transition border border-transparent hover:border-amber-100">
                        <input type="checkbox" name="dieta" value="Vegetariano" class="mr-3 accent-amber-600">
                        <span class="text-sm">Vegetariano/a</span>
                    </label>
                    <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-amber-50 transition border border-transparent hover:border-amber-100">
                        <input type="checkbox" name="dieta" value="Sin Gluten" class="mr-3 accent-amber-600">
                        <span class="text-sm">Sin Gluten</span>
                    </label>
                    <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-amber-50 transition border border-transparent hover:border-amber-100">
                        <input type="checkbox" name="dieta" value="Sin Lactosa" class="mr-3 accent-amber-600">
                        <span class="text-sm">Sin Lactosa</span>
                    </label>
                </div>

                <div class="mt-2">
                    <label class="block text-xs text-gray-400 mb-2 px-1">Â¿Alguna otra alergia o detalle importante?</label>
                    <textarea name="dieta_detalles" rows="2"
                              class="w-full p-4 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-amber-200 outline-none transition"
                              placeholder="Ej: Alergia a los frutos secos, al marisco..."></textarea>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                <div>
                    <label class="block text-sm font-semibold mb-2 text-amber-700 italic">ğŸ¸ Bebida favorita</label>
                    <input type="text" name="bebida"
                           class="w-full p-4 bg-gray-50 border-none rounded-xl outline-none focus:ring-2 focus:ring-amber-200"
                           placeholder="Ej: Gin Tonic">
                </div>
                <div class="relative">
                    <label class="block text-sm font-semibold mb-2 text-amber-700 italic">ğŸ’ƒ CanciÃ³n</label>
                    <input type="text" id="song-search" name="cancion"
                           class="w-full p-4 bg-gray-50 border-none rounded-xl outline-none focus:ring-2 focus:ring-amber-200"
                           placeholder="Busca tu tema..." autocomplete="off">
                    <div id="song-results" class="absolute z-20 w-full bg-white shadow-2xl rounded-b-xl hidden max-h-60 overflow-y-auto mt-1 border border-amber-50"></div>
                </div>
            </div>

            <button type="submit" id="submit-btn"
                    class="w-full bg-amber-700 hover:bg-amber-800 text-white font-bold py-5 rounded-2xl transition duration-300 transform hover:-translate-y-1 shadow-lg shadow-amber-900/20 uppercase tracking-widest text-sm">
                Confirmar Asistencia
            </button>
        </form>
    </div>

    <div id="thank-you-message" class="hidden text-center bg-white p-12 rounded-[2rem] shadow-xl border border-amber-50">
        <h2 class="titulo-boda text-5xl text-amber-700 mb-4">Â¡Muchas gracias!</h2>
        <p class="text-gray-600 mb-6 font-light italic text-sm italic">Tu confirmaciÃ³n ha llegado correctamente.</p>

        <button onclick="window.location.reload()"
                class="text-amber-700 border border-amber-700 px-6 py-2 rounded-xl hover:bg-amber-50 transition text-xs font-semibold mb-8">
            Confirmar a otra persona
        </button>

        <div class="text-4xl">ğŸ¥‚ğŸ’–ğŸš‘ğŸ”¥</div>
    </div>

    <footer class="text-center mt-12 text-gray-400 text-[10px] tracking-widest uppercase font-light">
        Hecho con â¤ï¸ por la mejor hermana programadora
    </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
    // --- 1. CONTADOR ---
    const targetDate = new Date('June 6, 2026 18:30:00').getTime();
    function updateCountdown() {
        const now = new Date().getTime();
        const diff = targetDate - now;
        document.getElementById('days').innerText = String(Math.floor(diff / (1000 * 60 * 60 * 24))).padStart(2, '0');
        document.getElementById('hours').innerText = String(Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).padStart(2, '0');
        document.getElementById('minutes').innerText = String(Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))).padStart(2, '0');
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    // --- 2. BUSCADOR DE CANCIONES ---
    const songInput = document.getElementById('song-search');
    const resultsDiv = document.getElementById('song-results');
    songInput.addEventListener('input', async (e) => {
        const query = e.target.value;
        if (query.length < 3) { resultsDiv.classList.add('hidden'); return; }
        try {
            const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=5`);
            const data = await res.json();
            resultsDiv.innerHTML = '';
            if (data.results.length > 0) {
                resultsDiv.classList.remove('hidden');
                data.results.forEach(track => {
                    const row = document.createElement('div');
                    row.className = 'p-3 hover:bg-amber-50 cursor-pointer flex items-center gap-3 border-b border-gray-50';
                    row.innerHTML = `<img src="${track.artworkUrl30}" class="rounded"><div><p class="text-xs font-bold">${track.trackName}</p><p class="text-[10px] text-gray-400">${track.artistName}</p></div>`;
                    row.onclick = () => { songInput.value = `${track.trackName} - ${track.artistName}`; resultsDiv.classList.add('hidden'); };
                    resultsDiv.appendChild(row);
                });
            }
        } catch (err) { console.log(err); }
    });

    // --- 3. ENVÃO DEL FORMULARIO ---
    const form = document.getElementById('wedding-form');
    const formContainer = document.getElementById('form-container');
    const thankYouMessage = document.getElementById('thank-you-message');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#bfa37e', '#fdfaf7', '#a88e6a'] });

        const formData = new FormData(form);

        // Convertir FormData a URLSearchParams para Google Apps Script
        const data = new URLSearchParams();
        for (const pair of formData) {
            data.append(pair[0], pair[1]);
        }

        try {
            // Enviamos con modo no-cors porque Google Apps Script a veces da problemas de CORS
            // pero el dato llega igual.
            fetch(form.action, {
                method: 'POST',
                body: data,
                mode: 'no-cors'
            });

            // Como usamos no-cors no podemos leer la respuesta ok,
            // asÃ­ que asumimos Ã©xito tras el envÃ­o.
            formContainer.classList.add('hidden');
            thankYouMessage.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

        } catch (error) {
            alert('Ups! Algo ha fallado al enviar. Por favor, intÃ©ntalo de nuevo.');
        }
    });

    // --- 4. LÃ“GICA DEL AVISO ---
    const selectInvitados = document.getElementById('select-invitados');
    const avisoInvitados = document.getElementById('aviso-invitados');

    selectInvitados.addEventListener('change', function() {
        if (this.value !== '1') {
            avisoInvitados.classList.remove('hidden');
        } else {
            avisoInvitados.classList.add('hidden');
        }
    });

    document.addEventListener('click', (e) => { if (e.target !== songInput) resultsDiv.classList.add('hidden'); });
</script>
</body>
</html>